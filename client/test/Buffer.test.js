test("Test loading buffer from 4 bit hex numbers", () => {
    // Hex decoded into bits inside buffer. 
    expect(Buffer.from([0xFF]).readUintBE(0, 1)).toBe(255);
    // What the buffer looks like:
    expect(0b1111_1111).toBe(255);
})

test("Allocate buffer memory and then populate it", () => {
    let buffer = Buffer.alloc(12);
    // Only write to 8 bytes
    buffer.write("Benjamin", "utf8");
    // Only writes the first 4 bytes, since buffer size is 12
    buffer.write("!!!!????", 8, "utf8");
    expect(buffer.toString("utf8")).toBe("Benjamin!!!!");
    
    let result = [];
    for(let i = 0; i<buffer.length; i++){
        result.push(buffer.readUInt8(i));
    }
    
    expect(result).toStrictEqual([66, 101, 110, 106, 97, 109, 105, 110, 33, 33, 33, 33]);
})

// base 64 is 2^6, 6 bits
test("Allocate space and write base64", () => {

    // allocate 3 bytes, 24 bits
    let buffer = Buffer.alloc(3);
    // each character maps to 6 bits in base64 (6*3=24)
    buffer.write("node", "base64");


    // n_o_d_e --> read as 24bit integer
    expect(0b100111_101000_011101_011110).toStrictEqual(buffer.readUIntBE(0, 3));
    expect(buffer.toString("base64")).toBe("node");
})

test("Read large unsigned int into Buffer and back to uint8 array", () => {

    let text = "apple";
    encoder = new TextEncoder('utf8');
    let textBuffer = encoder.encode(text).buffer;

    
    expect(textBuffer instanceof ArrayBuffer).toBe(true);
    expect(textBuffer.byteLength).toBe(5);

    let decodedText = Buffer.from(textBuffer, 0, 5).toString("utf8");

    expect(decodedText).toBe("apple");
    expect(Buffer.from(decodedText).byteLength).toBe(5);
    
});

test("Buffer test", () => {

        let uintArr = new Uint8Array([
            86,
            108,
            202,
            29,
            87,
            178,
            121,
            158,
            61,
            41,
            20,
            35,
            194,
            38,
            118,
            207,
            250,
            71,
            80,
            136,
            200,
            247,
            229,
            20,
            127,
            126,
            240,
            238,
            93,
            46,
            209,
            166,
            19,
            171,
            164,
            131,
            68,
            244,
            47,
            59,
            203,
            200,
            44,
            109,
            232,
            190,
            130,
            210,
            241,
            220,
            186,
            139,
            195,
            42,
            34,
            199,
            231,
            16,
            212,
            114,
            61,
            172,
            45,
            111,
            104,
            56,
            159,
            86,
            246,
            189,
            115,
            218,
            192,
            77,
            216,
            168,
            111,
            101,
            175,
            14,
            162,
            141,
            23,
            168,
            182,
            106,
            136,
            106,
            223,
            111,
            124,
            26,
            150,
            152,
            57,
            45,
            62,
            227,
            204,
            79,
            172,
            173,
            91,
            191,
            125,
            5,
            218,
            214,
            238,
            95,
            240,
            51,
            66,
            211,
            240,
            249,
            226,
            237,
            94,
            164,
            221,
            114,
            244,
            15,
            197,
            47,
            255,
            177,
            137,
            184,
            79,
            219,
            18,
            111,
            236,
            128,
            199,
            171,
            39,
            225,
            105,
            101,
            141,
            177,
            101,
            244,
            151,
            190,
            47,
            216,
            2,
            104,
            236,
            144,
            130,
            179,
            73,
            210,
            12,
            16,
            108,
            64,
            51,
            148,
            154,
            108,
            247,
            176,
            204,
            44,
            225,
            120,
            104,
            99,
            181,
            185,
            2,
            205,
            2,
            32,
            240,
            163,
            8,
            52,
            251,
            255,
            174,
            239,
            96,
            74,
            14,
            68,
            201,
            54,
            17,
            18,
            195,
            76,
            2,
            204,
            0,
            219,
            157,
            135,
            160,
            30,
            166,
            2,
            214,
            126,
            105,
            234,
            236,
            97,
            111,
            206,
            162,
            6,
            17,
            227,
            118,
            191,
            209,
            133,
            48,
            155,
            215,
            173,
            207,
            83,
            7,
            12,
            99,
            237,
            201,
            238,
            74,
            131,
            181,
            189,
            64,
            175,
            208,
            85,
            173,
            162,
            166,
            51,
            108,
            231,
            116,
            161,
            255,
            10,
            249,
            44,
            119,
            6,
            4,
            142,
            80,
            215,
            18,
            242,
            28,
            23,
            177,
            218,
            26,
            123,
            196,
            2,
            196,
            10,
            232,
            8,
            91,
            86,
            35,
            37,
            117,
            165,
            205,
            219,
            83,
            175,
            130,
            128,
            98,
            251,
            208,
            84,
            70,
            5,
            162,
            113,
            112,
            157,
            46,
            14,
            140,
            232,
            52,
            187,
            10,
            150,
            63,
            154,
            26,
            71,
            218,
            57,
            171,
            150,
            49,
            253,
            5,
            178,
            12,
            50,
            26,
            63,
            143,
            171,
            153,
            178,
            164,
            207,
            68,
            76,
            13,
            206,
            239,
            220,
            216,
            55,
            154,
            33,
            156,
            124,
            7,
            187,
            84,
            252,
            166,
            168,
            154,
            150,
            207,
            30,
            168,
            192,
            153,
            65,
            193,
            115,
            62,
            72,
            163,
            31,
            46,
            192,
            210,
            235,
            60,
            146,
            100,
            141,
            109,
            217,
            30,
            134,
            248,
            30,
            196,
            147,
            220,
            235,
            44,
            136,
            159,
            67,
            150,
            101,
            168,
            250,
            122,
            251,
            14,
            252,
            182,
            177,
            212,
            152,
            89,
            138,
            99,
            162,
            115,
            215,
            167,
            50,
            5,
            5,
            187,
            95,
            141,
            135,
            131,
            165,
            153,
            146,
            19,
            69,
            35,
            199,
            92,
            165,
            174,
            153,
            123,
            212,
            213,
            12,
            238,
            84,
            146,
            94,
            132,
            231,
            243,
            93,
            242,
            253,
            177,
            229,
            63,
            251,
            139,
            21,
            218,
            73,
            83,
            85,
            192,
            14,
            146,
            123,
            210,
            84,
            23,
            237,
            200,
            57,
            92,
            163,
            170,
            179,
            114,
            248,
            242,
            123,
            191,
            211,
            5,
            187,
            121,
            60,
            118,
            0,
            140,
            16,
            170,
            15,
            48,
            129,
            234,
            254,
            82,
            230,
            159,
            75,
            35,
            218,
            76,
            23,
            250,
            32,
            109,
            130,
            161,
            226,
            101,
            161,
            206,
            77,
            98,
            74,
            76,
            82,
            115,
            52,
            133,
            97,
            74,
            1,
            148,
            22,
            110,
            198,
            21,
            41
        ]
        );

        let nodeBuffer = Buffer.from(uintArr.buffer, 0, 512);
        expect(nodeBuffer.byteLength).toBe(512);


        let encodedBuffer = nodeBuffer.toString('base64')
        let decodedBuffer = Buffer.from(encodedBuffer, 'base64');

        expect(decodedBuffer.byteLength).toBe(512);
        
})